name: Build and Release

on:
  push:
    tags:
      - 'v*'  # ç•¶æ¨é€ä»¥ v é–‹é ­çš„ tag æ™‚è§¸ç™¼ï¼ˆä¾‹å¦‚ v1.0.0ï¼‰

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Build executable with PyInstaller
      run: |
        pyinstaller yzuCourseBot.spec
        
    - name: Rename executable
      run: |
        cd dist
        dir
        
    - name: Verify executable exists
      run: |
        if (-not (Test-Path "dist\å…ƒæ™ºé¸èª²æ©Ÿå™¨äºº.exe")) {
          echo "Error: Executable not found!"
          exit 1
        }
        echo "Executable found successfully"
        
    - name: Create ZIP archive
      run: |
        cd dist
        powershell Compress-Archive -Path "å…ƒæ™ºé¸èª²æ©Ÿå™¨äºº.exe" -DestinationPath "YZUCourseBot.zip"
        dir
        
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/YZUCourseBot.zip
        body: |
          ## å…ƒæ™ºå¤§å­¸é¸èª²æ©Ÿå™¨äºº ${{ github.ref_name }}
          
          ### ğŸ“¥ ä¸‹è¼‰èªªæ˜
          
          ä¸‹è¼‰ `YZUCourseBot.zip`
          
          ### ä½¿ç”¨æ–¹å¼
          1. ä¸‹è¼‰ `YZUCourseBot.zip`
          2. è§£å£“ç¸® ZIP æª”æ¡ˆ
          3. é›™æ“ŠåŸ·è¡Œ `å…ƒæ™ºé¸èª²æ©Ÿå™¨äºº.exe`
          4. åœ¨åœ–å½¢ä»‹é¢ä¸­è¼¸å…¥å¸³è™Ÿã€å¯†ç¢¼ã€èª²ç¨‹æ¸…å–®
          5. é»æ“Šã€Œé–‹å§‹é¸èª²ã€æŒ‰éˆ•
          
          ### èª²ç¨‹æ¸…å–®æ ¼å¼
          æ¯è¡Œä¸€å€‹èª²ç¨‹ï¼Œæ ¼å¼ï¼š`ç³»æ‰€ä»£ç¢¼,èª²ç¨‹ä»£ç¢¼`
          
          ç¯„ä¾‹ï¼š
          ```
          312,EEB219A
          304,CS201B
          ```
          
          ### âš ï¸ æ³¨æ„äº‹é …
          - è«‹ç¢ºä¿è§£å£“ç¸®å¾Œå†åŸ·è¡Œï¼Œä¸è¦ç›´æ¥åœ¨å£“ç¸®æª”å…§åŸ·è¡Œ
          - éƒ¨åˆ†é˜²æ¯’è»Ÿé«”å¯èƒ½æœƒèª¤å ±ï¼Œè«‹åŠ å…¥ä¿¡ä»»æ¸…å–®
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: YZUCourseBot-${{ github.ref_name }}
        path: dist/YZUCourseBot.zip

